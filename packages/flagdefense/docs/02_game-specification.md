# Nation Unity Defense - ゲーム仕様書

## 概要
Nation Unity Defenseは、国連非加盟国をテーマにしたタワーディフェンスゲームです。プレイヤーは小国から始めて、徐々に強力な国家を解放しながら基地を防衛します。

## ゲームの基本仕様

### ゲームモード
- **menu**: メインメニュー画面
- **playing**: ゲームプレイ中
- **paused**: 一時停止（未実装）
- **victory**: 勝利画面（全20国家解放時）
- **defeat**: 敗北画面（基地HP0時）

### 勝利条件
- 全20国家をアンロックし、全ての敵を撃破する

### 敗北条件
- 基地のHPが0になる

### ゲームフロー
1. Wave開始前のカウントダウン（30秒）
2. プレイヤーは国家タワーを配置
3. Wave開始（手動または自動）
4. 敵がパスに沿って進行
5. タワーが自動攻撃
6. Wave完了で新国家アンロック
7. 繰り返し

## 国家データ仕様

### 国家総数: 20カ国（5ティア）

### Tier 1: 承認国が少ない小国（4カ国）
| ID | 名前 | コスト | 攻撃力 | 射程 | シンボル |
|---|---|---|---|---|---|
| liberland | リベルランド | 20 | 3 | 80 | 🏴 |
| transnistria | 沿ドニエストル | 30 | 4 | 90 | 🔨 |
| somaliland | ソマリランド | 40 | 5 | 100 | ⭐ |
| northcyprus | 北キプロス | 50 | 6 | 100 | ☪️ |

### Tier 2: 地域的承認を持つ国（4カ国）
| ID | 名前 | コスト | 攻撃力 | 射程 | シンボル |
|---|---|---|---|---|---|
| southossetia | 南オセチア | 80 | 10 | 110 | 🦅 |
| abkhazia | アブハジア | 100 | 12 | 120 | 🌟 |
| chechnya | チェチェン | 120 | 15 | 120 | 🐺 |
| sahrawi | サハラ・アラブ | 150 | 18 | 130 | 🌙 |

### Tier 3: 国際的認知がある国（4カ国）
| ID | 名前 | コスト | 攻撃力 | 射程 | シンボル |
|---|---|---|---|---|---|
| cook | クック諸島 | 200 | 22 | 140 | 🌴 |
| niue | ニウエ | 250 | 25 | 140 | 🌺 |
| kosovo | コソボ | 300 | 30 | 150 | 🦅 |
| palestine | パレスチナ | 400 | 35 | 160 | 🇵🇸 |

### Tier 4: 特殊地位・広く認知（4カ国）
| ID | 名前 | コスト | 攻撃力 | 射程 | シンボル |
|---|---|---|---|---|---|
| vatican | バチカン | 500 | 45 | 170 | ✝️ |
| taiwan | 台湾 | 700 | 55 | 180 | 🇹🇼 |
| hongkong | 香港 | 900 | 65 | 190 | 🌸 |
| macau | マカオ | 1100 | 75 | 190 | 🎰 |

### Tier 5: 大国（ボーナス）（4カ国）
| ID | 名前 | コスト | 攻撃力 | 射程 | シンボル |
|---|---|---|---|---|---|
| japan | 日本 | 1500 | 85 | 200 | 🇯🇵 |
| germany | ドイツ | 2000 | 95 | 210 | 🇩🇪 |
| usa | アメリカ | 3000 | 110 | 220 | 🇺🇸 |
| china | 中国 | 4000 | 130 | 240 | 🇨🇳 |

### アンロックシステム
- 初期: liberland（リベルランド）のみ
- Wave完了時: `Math.min(5, Math.ceil(wave / 3))` までのTierの国家が解放
- 例: Wave3でTier1全解放、Wave6でTier2全解放

## 敵データ仕様

### 敵タイプ（5種類）
| タイプ | 基本HP | 速度 | 報酬 | サイズ | 出現条件 |
|---|---|---|---|---|---|
| soldier | 8 | 40 | 8 | 15 | 通常 |
| tank | 20 | 20 | 20 | 20 | Wave5毎の中ボス |
| jet | 12 | 80 | 15 | 18 | 通常 |
| elite | 40 | 30 | 40 | 22 | Wave10以降20%確率 |
| boss | 60 | 15 | 100 | 30 | Wave15毎のボス |

### 敵のHP計算
- 動的バランスシステムを採用
- 配置済みタワーの総火力から必要HPを逆算
- ハードモード時は1.3倍

## ゲームシステム仕様

### 経済システム
- 初期コイン: 80
- パッシブインカム: 1コイン/秒（Wave3毎に+1）
- 敵撃破報酬: 敵タイプによる
- ハードスキップ: コイン2倍、敵強化1.3倍

### Wave システム
- 初期カウントダウン: 30秒
- 敵数: `Math.min(25, wave + 4)`
- 出現間隔: 1秒
- 自動開始: カウントダウン0で開始
- 手動開始: 通常開始またはハードスキップ

### タワーシステム
- 配置制限: パス上には配置不可
- 攻撃間隔: 1秒
- ターゲット: 射程内の最も近い敵
- 削除: Deleteキーまたはゴミ箱アイコン

### パスシステム
- 8つのウェイポイントによる折れ線パス
- パス幅: 40ピクセル
- 基地位置: (700, 200)

## UI/UX仕様

### メインUI要素
1. **ヘッダー**
   - コイン表示（パッシブインカム付き）
   - Wave数表示
   - 基地HP表示
   - ハードモード表示

2. **キャンバス**（800x400）
   - パス表示
   - タワー配置
   - 敵の移動
   - 攻撃エフェクト

3. **国家ショップ**（幅320px）
   - 国家リスト（スクロール可能）
   - 購入可能/不可能の表示
   - アンロック状態の表示
   - デバッグボタン（コイン2倍）

### 操作方法
- **タワー配置**: 国家選択→キャンバスクリック
- **タワー選択**: 配置済みタワーをクリック
- **タワー削除**: 選択→Deleteキー
- **Wave開始**: ボタンクリックまたは自動

### ビジュアル
- 国旗風のタワー/敵表示
- 複数色による国旗パターン（2-4色対応）
- HP バー表示
- 射程範囲表示（選択時）
- 攻撃エフェクト（ライン）

## 特殊機能

### デバッグ機能
- メニュー画面: 仕様テスト結果表示
- ゲーム画面: コイン2倍ボタン
- 各種バランステスト実装済み

### 自動テスト項目
1. 国家数の検証（20カ国）
2. 初期コイン検証
3. パス定義検証
4. 敵タイプ検証
5. アンロックシステム検証
6. 価格バランス検証